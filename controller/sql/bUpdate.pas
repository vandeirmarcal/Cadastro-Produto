{ ------------------------- INFORMAÇÕES GERAIS ---------------------------------
  bSelect (Representa uma consulta SQL - SELECT)
  Data início: 13/06/2016

  Vandeir Roberto Marçal
  AJI - Sistemas
 ----------------------------------------------------------------------------- }
unit bUpdate;

interface

 uses DBClient, Classes, bCriterioSql,IBX.IBQuery,IBX.IBDataBase,pDataModule;

 type TUpdate = class (TCriterio)
   private
     { --------------------------- ATRIBUTOS --------------------------------- }


   protected

   public

     { -------------------------- GERAL -------------------------------------- }

     {
      Constrói uma consulta SQL

      Return:
          a consulta SQL
     }
     function buildSQL  : string;  override;

     procedure addColuna (nome: string; valor : variant);overload;

 end;

implementation

uses
 sysutils;

function TUpdate.buildSQL : string;

var i : integer;
    sql : string;

begin

  // Herda
  Result := '';

  // SELECT
  sql := 'UPDATE ';

  // TABELAS
  for i:=0 to tabelas.Count-2 do begin

    sql := sql + montaTabela(i) + ',';
  end;

  // Último campo
  sql := sql + montaTabela(tabelas.Count-1)+' SET ';

  // CAMPOS
  for i:=0 to Length(campo)-2 do
  begin

    sql := sql + campo[i].nomeCampo+' = :'+campo[i].parametro+', ';
  end;

  // Último campo
  sql := sql + campo[i].nomeCampo+' = :'+campo[i].parametro+'';

  // Verifico se exist critério
  if (Length(criterio) > 0) then
  begin
    sql := sql + ' WHERE ' + buildCriterio;
  end;

  // Guarda para próximo BUILD
  Result := sql;
end;

procedure TUpdate.addColuna (nome: string; valor : variant );

var tamanho : integer;

begin

  tamanho := Length(campo);

  // Adiciono uma posição na estrutura
  SetLength(campo,tamanho+1);

  // Monto o critério
  campo[tamanho].nomeCampo   := nome;
  campo[tamanho].parametro   := 'p'+nome;
  campo[tamanho].valorCampo  := valor;
end;


end.
